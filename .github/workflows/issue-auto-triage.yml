name: Issue Auto Triage

on:
  issues:
    types: [opened, labeled]
    if: contains(github.event.issue.labels.*.name, 'triage')

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Run Claude Code Action
        uses: anthropics/claude-code-action@v1
        env:
          ANTHROPIC_BASE_URL: https://openrouter.ai/api
        with:
          api_key: ${{ secrets.OPENROUTER_API_KEY }}
          model: claude-3-5-sonnet-20241022
          prompt: |
            REPO: ${{ github.repository }}
            ISSUE NUMBER: ${{ github.event.issue.number }}
            TITLE: ${{ github.event.issue.title }}
            BODY: ${{ github.event.issue.body }}

            分析这个新 Issue：
            1. 判断类型：bug / feature / question / duplicate
            2. 评估优先级：critical / high / medium / low
            3. 建议标签
            4. 检查是否重复现有 Issue

            使用 gh 命令自动添加合适标签，如果是重复请评论指出原 Issue。
          allowed_tools: '["github:add_label", "github:comment_on_issue", "github:search_issues"]'
