name: AI Product PM

on:
  issues:
    types: [labeled]

jobs:
  pm-insight:
    if: github.event.label.name == 'ğŸ’¡ insight'
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: "PM Analysis"
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
        uses: actions/github-script@v7
        with:
          script: |
            const prompt = `ä½ æ˜¯ä¸€ä¸ªèµ„æ·±äº§å“ç»ç†ã€‚è¯·å¯¹ä»¥ä¸‹éœ€æ±‚è¿›è¡Œäº§å“åŒ–æ‹†è§£ï¼š
            æ ‡é¢˜: ${process.env.ISSUE_TITLE}
            æè¿°: ${process.env.ISSUE_BODY || "ï¼ˆæ— æè¿°ï¼‰"}
            
            è¯·ç»™å‡ºï¼šæ ¸å¿ƒç—›ç‚¹ã€ç”¨æˆ·æ•…äº‹ã€MVP åŠŸèƒ½èŒƒå›´ã€æ½œåœ¨é£é™©ç‚¹ã€‚`;

            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,
                'Content-Type': 'application/json',
                'HTTP-Referer': 'https://github.com/ai-product-pm'
              },
              body: JSON.stringify({
                model: "anthropic/claude-sonnet-4.5",
                messages: [{ role: "user", content: prompt }]
              })
            });

            const data = await response.json();
            const aiResponse = data.choices[0].message.content;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: "ğŸ’¡ **AI äº§å“éœ€æ±‚æ´å¯Ÿ:**\n\n" + aiResponse
            });
